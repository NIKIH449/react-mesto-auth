(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{20:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(10),i=n.n(s),o=(n(9),n(13)),r=n(3),u=n.p+"static/media/logo.03b78ada.svg",l=n(2),p=n(5),d=n(0);var j=function(e){var t=Object(l.f)();return Object(d.jsxs)("header",{className:"header",children:[Object(d.jsx)("a",{href:"https://nikitas.nomoredomains.work/",children:Object(d.jsx)("img",{className:"header__logo",src:u,alt:"\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438"})}),e.isLoading?"":e.loggedIn?Object(d.jsxs)("div",{className:"header__container",children:[Object(d.jsx)("p",{className:"header__login",children:e.email}),Object(d.jsx)("button",{onClick:e.onSignOut,type:"submit",className:"header__button",children:"Logout"})]}):"/sign-up"===t.pathname?Object(d.jsx)(p.b,{to:"/sign-in",className:"header__link",children:"Login"}):Object(d.jsx)(p.b,{to:"/sign-up",className:"header__link",children:"Registration"})]})};var h=function(){return Object(d.jsx)("footer",{className:"footer",children:Object(d.jsx)("p",{className:"footer__copyright",children:"\xa9 2021 Nikita Druzhevskii"})})},b=c.a.createContext();var _=function(e){var t=Object(a.useContext)(b),n=e.card.owner._id===t._id,c="element__button-remove ".concat(n?"element__button-remove":"element__button-remove_disable"),s=e.card.likes.some((function(e){return e._id===t._id})),i="element__button-like ".concat(s?"element__button-like_active":"element__button-like");return Object(d.jsxs)("li",{className:"element",children:[Object(d.jsx)("button",{onClick:function(){e.onCardDelete(e.card)},className:c,type:"button","aria-label":"Delete"}),Object(d.jsx)("img",{onClick:function(){e.onCardClick(e.card)},src:e.card.link,alt:e.card.name,className:"element__picture"}),Object(d.jsxs)("div",{className:"element__container",children:[Object(d.jsx)("h2",{className:"element__place-name",children:e.card.name}),Object(d.jsxs)("div",{children:[Object(d.jsx)("button",{onClick:function(){e.onCardLike(e.card)},className:i,"aria-label":"Like",type:"button"}),Object(d.jsx)("div",{className:"element__likes",children:e.card.likes.length})]})]})]})};var m=function(e){var t=Object(a.useContext)(b);return Object(d.jsxs)("main",{className:"main",children:[Object(d.jsxs)("section",{className:"profile",children:[Object(d.jsxs)("div",{className:"profile__container",children:[Object(d.jsxs)("div",{className:"profile__avatar-container",children:[Object(d.jsx)("img",{className:"profile__avatar",src:t.avatar,alt:"avatar"}),Object(d.jsx)("button",{onClick:e.onEditAvatar,className:"profile__button profile__button_type_avatar","aria-label":"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",type:"button"})]}),Object(d.jsxs)("div",{className:"profile__profile-info",children:[Object(d.jsxs)("div",{className:"profile__main-info",children:[Object(d.jsx)("h1",{className:"profile__name",children:t.name}),Object(d.jsx)("button",{onClick:e.onEditProfile,className:"profile__button profile__button_type_edit","aria-label":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",type:"button"})]}),Object(d.jsx)("p",{className:"profile__description",children:t.about})]})]}),Object(d.jsx)("button",{onClick:e.onAddPlace,className:"profile__button profile__button_type_plus","aria-label":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",type:"button"})]}),Object(d.jsx)("section",{className:"elements",children:Object(d.jsx)("ul",{className:"elements__list",children:e.card.map((function(t){return Object(d.jsx)(_,{onCardDelete:e.onCardDelete,onCardClick:e.onCardClick,onCardLike:e.onCardLike,card:t},t._id)}))})})]})};var O=function(e){return Object(d.jsx)("div",{onClick:e.onClose,className:"popup ".concat(e.card?"popup_opened":"","  popup_type_picture"),children:Object(d.jsxs)("div",{className:"popup__picture",onClick:function(e){return e.stopPropagation()},children:[Object(d.jsx)("button",{onClick:e.onClose,type:"button",className:"popup__button-close popup__button-close_type_picture"}),Object(d.jsx)("img",{className:"popup__image",src:"".concat(e.card?e.card.link:"#"),alt:"".concat(e.card?e.card.name:"")}),Object(d.jsx)("p",{className:"popup__picture-description",children:"".concat(e.card?e.card.name:"")})]})})};var f=function(e){return Object(a.useEffect)((function(){function t(t){"Escape"===t.key&&e.onClose()}return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}}),[e]),Object(d.jsx)("div",{className:"popup ".concat(e.isOpen?"popup_opened":""," popup_type_").concat(e.name),onMouseDown:e.onClose,children:Object(d.jsx)("div",{className:"popup__container",onMouseDown:function(e){return e.stopPropagation()},children:Object(d.jsxs)("form",{className:"popup__form",name:e.name,onSubmit:e.onSubmit,children:[Object(d.jsx)("button",{type:"button",onClick:e.onClose,className:"popup__button-close popup__button-close_type_".concat(e.name)}),e.title&&Object(d.jsx)("h2",{className:"popup__title",children:e.title}),e.children,e.buttonText&&Object(d.jsx)("button",{className:"popup__button-save popup__button-save_type_".concat(e.name),type:"submit",children:e.buttonText})]})})})};var v=function(e){var t=Object(a.useState)(""),n=Object(r.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(""),o=Object(r.a)(i,2),u=o[0],l=o[1],p=Object(a.useContext)(b);return Object(a.useEffect)((function(){s(p.name),l(p.about)}),[p,e.isOpen]),Object(d.jsxs)(f,{onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:u})},onClose:e.onClose,isOpen:e.isOpen,name:"edit-profile",title:"Edit profile",buttonText:"Save",children:[Object(d.jsxs)("div",{className:"popup__input-container",children:[Object(d.jsx)("input",{id:"name-input",type:"text",name:"username",className:"popup__input popup__input_type_name",placeholder:"Name",required:!0,minLength:"2",maxLength:"40",value:c||"",onChange:function(e){s(e.target.value)}}),Object(d.jsx)("span",{className:"popup__input-error name-input-error"})]}),Object(d.jsxs)("div",{className:"popup__input-container",children:[Object(d.jsx)("input",{id:"desription-input",type:"text",name:"description",className:"popup__input popup__input_type_desription",placeholder:"About",required:!0,minLength:"2",maxLength:"200",value:u||"",onChange:function(e){l(e.target.value)}}),Object(d.jsx)("span",{className:"popup__input-error desription-input-error"})]})]})};var x=function(e){var t=Object(a.useRef)("");return Object(d.jsx)(f,{onSubmit:function(n){n.preventDefault(),e.onUpdateAvatar({avatar:t.current.value}),t.current.value=""},onClose:e.onClose,isOpen:e.isOpen,name:"change-avatar",title:"Update avatar",buttonText:"Save",children:Object(d.jsxs)("div",{className:"popup__input-container",children:[Object(d.jsx)("input",{id:"avatar-input",type:"url",name:"avatar",className:"popup__input popup__input_change-avatar",placeholder:"Link to avatar",required:!0,ref:t}),Object(d.jsx)("span",{className:"popup__input-error avatar-input-error"})]})})};var g=function(e){var t=Object(a.useState)(""),n=Object(r.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(""),o=Object(r.a)(i,2),u=o[0],l=o[1];return Object(d.jsxs)(f,{onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:c,link:u}),s(""),l("")},onClose:e.onClose,isOpen:e.isOpen,name:"add-picture",title:"New place",buttonText:"Create",children:[Object(d.jsxs)("div",{className:"popup__input-container",children:[Object(d.jsx)("input",{id:"place-input",type:"text",name:"name",className:"popup__input popup__input_type_place",placeholder:"Name",required:!0,minLength:"2",maxLength:"30",value:c,onChange:function(e){s(e.target.value)}}),Object(d.jsx)("span",{className:"popup__input-error place-input-error"})]}),Object(d.jsxs)("div",{className:"popup__input-container",children:[Object(d.jsx)("input",{id:"url-input",type:"url",name:"link",className:"popup__input popup__input_type_picture",placeholder:"Link to picture",required:!0,value:u,onChange:function(e){l(e.target.value)}}),Object(d.jsx)("span",{className:"popup__input-error url-input-error"})]})]})};var N=function(e){var t=Object(a.useState)(""),n=Object(r.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(""),o=Object(r.a)(i,2),u=o[0],l=o[1];return Object(d.jsx)("section",{className:"auth",children:Object(d.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.onLogin(u,c)},className:"auth__form",children:[Object(d.jsxs)("div",{className:"auth__container",children:[Object(d.jsx)("h2",{className:"auth__title",children:"Login"}),Object(d.jsx)("input",{value:c,onChange:function(e){s(e.target.value)},id:"auth__input",type:"email",name:"email",className:"auth__input",placeholder:"Email",required:!0}),Object(d.jsx)("input",{value:u,onChange:function(e){l(e.target.value)},id:"password",type:"password",name:"password",className:"auth__input",placeholder:"Password",minLength:"6",maxLength:"40"})]}),Object(d.jsx)("button",{type:"sumbit",className:"auth__submit-button",children:"Login"})]})})};var k=function(e){var t=Object(a.useState)(""),n=Object(r.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)(""),o=Object(r.a)(i,2),u=o[0],l=o[1];return Object(d.jsx)("section",{className:"auth",children:Object(d.jsxs)("form",{className:"auth__form",onSubmit:function(t){t.preventDefault(),e.onRegister(u,c)},children:[Object(d.jsxs)("div",{className:"auth__container",children:[Object(d.jsx)("h2",{className:"auth__title",children:"Registration"}),Object(d.jsx)("input",{value:c,onChange:function(e){s(e.target.value)},id:"auth__input",type:"email",name:"email",className:"auth__input",placeholder:"Email",required:!0}),Object(d.jsx)("input",{value:u,onChange:function(e){l(e.target.value)},id:"password",type:"password",name:"password",className:"auth__input",placeholder:"Password",minLength:"6",maxLength:"40",required:!0})]}),Object(d.jsxs)("div",{className:"auth__container",children:[Object(d.jsx)("button",{type:"submit",className:"auth__submit-button",children:"Register"}),Object(d.jsxs)("p",{className:"auth__paragraph",children:["Already registered?",Object(d.jsx)(p.b,{to:"/sign-in",className:"auth__link",children:"Login"})]})]})]})})};var C=function(e){return Object(d.jsxs)(f,{onClose:e.onClose,isOpen:e.isOpen,children:[Object(d.jsx)("img",{className:"infoTooltip__image",alt:"Notification",src:e.image}),Object(d.jsx)("p",{className:"infoTooltip__paragraph",children:e.title})]})},y=n(14),S=["children"],L=function(e){var t=e.children;return Object(y.a)(e,S).loggedIn?t:Object(d.jsx)(l.a,{to:"/sign-in"})},E=n(11),w=n(12),T=new(function(){function e(t){Object(E.a)(this,e),this._url=t.baseUrl,this._headers=t.headers}return Object(w.a)(e,[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}},{key:"changeLikeCardStatus",value:function(e,t){return fetch(this._url+"/cards/likes/".concat(e),{method:"".concat(t?"PUT":"DELETE"),headers:this._headers}).then(this._checkResponse)}},{key:"getUserInfo",value:function(){return fetch(this._url+"/users/me",{method:"GET",headers:this._headers}).then(this._checkResponse)}},{key:"setUserInfo",value:function(e){return fetch(this._url+"/users/me",{method:"PATCH",body:JSON.stringify({name:e.name,about:e.about}),headers:this._headers}).then(this._checkResponse)}},{key:"setUserAvatar",value:function(e){return fetch(this._url+"/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e.avatar}),headers:this._headers}).then(this._checkResponse)}},{key:"setNewCard",value:function(e){return fetch(this._url+"/cards",{method:"POST",body:JSON.stringify({name:e.name,link:e.link}),headers:this._headers}).then(this._checkResponse)}},{key:"getInitialCards",value:function(){return fetch(this._url+"/cards",{method:"GET",headers:this._headers}).then(this._checkResponse)}},{key:"putLike",value:function(e){return fetch(this._url+"/cards/likes/".concat(e),{method:"PUT",headers:this._headers}).then(this._checkResponse)}},{key:"deleteLike",value:function(e){return fetch(this._url+"/cards/likes/".concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}},{key:"deleteCard",value:function(e){return fetch(this._url+"/cards/".concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-28",headers:{authorization:"61ec0817-2cd1-4935-b48e-293d9bfb9a8c","Content-Type":"application/json"}}),P="https://auth.nomoreparties.co";function D(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}var R=n.p+"static/media/registered.1b6082f8.svg",U=n.p+"static/media/notRegistered.df8eddf6.svg";var A=function(){return Object(d.jsx)("div",{className:"preloader",children:"Loading..."})};var I=function(){var e=Object(a.useState)(!1),t=Object(r.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),i=Object(r.a)(s,2),u=i[0],p=i[1],_=Object(a.useState)(!1),f=Object(r.a)(_,2),y=f[0],S=f[1],E=Object(a.useState)(!1),w=Object(r.a)(E,2),I=w[0],q=w[1],J=Object(a.useState)(null),F=Object(r.a)(J,2),z=F[0],B=F[1],G=Object(a.useState)({}),M=Object(r.a)(G,2),H=M[0],K=M[1],Q=Object(a.useState)([]),V=Object(r.a)(Q,2),W=V[0],X=V[1],Y=Object(a.useState)(!1),Z=Object(r.a)(Y,2),$=Z[0],ee=Z[1],te=Object(a.useState)(""),ne=Object(r.a)(te,2),ae=ne[0],ce=ne[1],se=Object(a.useState)(""),ie=Object(r.a)(se,2),oe=ie[0],re=ie[1],ue=Object(a.useState)(""),le=Object(r.a)(ue,2),pe=le[0],de=le[1],je=Object(a.useState)(!0),he=Object(r.a)(je,2),be=he[0],_e=he[1],me=Object(l.g)(),Oe=Object(l.f)();function fe(){q(!0)}function ve(){S(!1),c(!1),p(!1),q(!1),B(null)}return Object(a.useEffect)((function(){var e=localStorage.getItem("token");e?function(e){return fetch("".concat(P,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(D)}(e).then((function(e){e&&(de(e.data.email),ee(!0),me("/"))})).catch((function(e){console.log(e),_e(!1)})):_e(!1)}),[me]),Object(a.useEffect)((function(){var e=T.getUserInfo(),t=T.getInitialCards();Promise.all([e,t]).then((function(e){K(e[0]),X(e[1]),_e(!1)})).catch((function(e){console.log(e),_e(!1)}))}),[]),Object(a.useEffect)((function(){"/react-mesto-auth"===Oe.pathname&&me("/sign-in")}),[]),Object(d.jsx)(b.Provider,{value:H,children:Object(d.jsxs)("div",{className:"page",children:[Object(d.jsx)(j,{email:pe,isLoading:be,loggedIn:$,onSignOut:function(){localStorage.removeItem("token"),me("/"),ee(!1)}}),be?Object(d.jsx)(A,{}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)(l.d,{children:[Object(d.jsx)(l.b,{path:"/sign-up",element:Object(d.jsx)(k,{onRegister:function(e,t){(function(e,t){return fetch("".concat(P,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then(D)})(e,t).then((function(){ce(R),re("\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0438\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"),me("/sign-in")})).catch((function(){ce(U),re("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.")})).finally(fe())}})}),Object(d.jsx)(l.b,{path:"/sign-in",element:Object(d.jsx)(N,{onLogin:function(e,t){(function(e,t){return fetch("".concat(P,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then(D)})(e,t).then((function(e){ee(!0),me("/"),localStorage.setItem("token",e.token)})).catch((function(){ce(U),re("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u0432\u0435\u0440\u043d\u044b."),fe()}))}})}),Object(d.jsx)(l.b,{path:"/",element:Object(d.jsx)(L,{loggedIn:$,children:Object(d.jsx)(m,{card:W,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===H._id}));T.changeLikeCardStatus(e._id,!t).then((function(t){X((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){console.log(e)}))},onCardDelete:function(e){T.deleteCard(e._id).then((function(t){X((function(t){return t.filter((function(t){return t._id!==e._id}))}))})).catch((function(e){console.log(e)}))},onCardClick:function(e){B(e)},onEditProfile:function(){c(!0)},onAddPlace:function(){p(!0)},onEditAvatar:function(){S(!0)}})})})]}),Object(d.jsx)(h,{}),Object(d.jsx)(O,{card:z,onClose:ve}),Object(d.jsx)(v,{isOpen:n,onClose:ve,onUpdateUser:function(e){T.setUserInfo(e).then((function(e){K(e),c(!1)})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(g,{isOpen:u,onClose:ve,onAddPlace:function(e){T.setNewCard(e).then((function(e){X([e].concat(Object(o.a)(W))),p(!1)})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(x,{isOpen:y,onClose:ve,onUpdateAvatar:function(e){T.setUserAvatar(e).then((function(e){K(e),S(!1)})).catch((function(e){console.log(e)}))}}),Object(d.jsx)(C,{image:ae,title:oe,isOpen:R&&oe&&I,onClose:ve})]})]})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),s(e),i(e)}))};i.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(p.a,{children:Object(d.jsx)(I,{})})}),document.getElementById("root")),q()},9:function(e,t,n){}},[[20,1,2]]]);
//# sourceMappingURL=main.f5ca147d.chunk.js.map